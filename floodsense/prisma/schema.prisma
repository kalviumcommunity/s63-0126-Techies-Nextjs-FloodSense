generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////////////////////////////////////
// ENUMS
//////////////////////////////////////////////////////

enum RiskLevel {
  LOW
  MODERATE
  HIGH
  SEVERE
}

//////////////////////////////////////////////////////
// MODELS
//////////////////////////////////////////////////////

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())

  // relations
  preferences AlertPreference?
  alerts      Alert[] // ðŸ”¥ alerts user received

  @@index([email])
}

//////////////////////////////////////////////////////

model District {
  id        String   @id @default(uuid())
  name      String
  state     String
  latitude  Float
  longitude Float
  createdAt DateTime @default(now())

  // relations
  weather WeatherData[]
  alerts  Alert[] // ðŸ”¥ alerts for this district

  @@unique([name, state])
}

//////////////////////////////////////////////////////

model WeatherData {
  id         String @id @default(uuid())
  districtId String

  rainfallMm  Float
  temperature Float
  humidity    Float
  riskLevel   RiskLevel

  recordedAt DateTime @default(now())

  district District @relation(fields: [districtId], references: [id], onDelete: Cascade)

  @@index([districtId])
  @@index([recordedAt])
}

//////////////////////////////////////////////////////
//NEW: ALERT MODEL 
//////////////////////////////////////////////////////

model Alert {
  id        String    @id @default(uuid())
  message   String
  severity  RiskLevel
  createdAt DateTime  @default(now())

  // relations
  districtId String
  district   District @relation(fields: [districtId], references: [id], onDelete: Cascade)

  userId String?
  user   User?   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([districtId])
  @@index([createdAt])
}

//////////////////////////////////////////////////////

model AlertPreference {
  id     String @id @default(uuid())
  userId String @unique

  rainfallThreshold Float
  riskThreshold     RiskLevel

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}
